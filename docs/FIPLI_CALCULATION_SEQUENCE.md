
# ANNUAL CALCULATION SEQUENCE

1. START YEAR
   Start with last year's ending balances

2. GROWTH STEP
   Apply growth rates to all assets 
   (This happens before any cash moves)

3. CALCULATE INFLOWS
   a. Scheduled Inflows
      - Take base amount
      - If inflation-adjusted: × (1 + inflation)^(years_from_start)
      - Add to total inflows
   
   b. Retirement Income (if retired)
      - Take base amount  
      - If inflation-adjusted: × (1 + inflation)^(years_from_start)
      - Add to total inflows

4. CALCULATE OUTFLOWS
   a. Process Liabilities
      - Calculate payments
      - Reduce principals
      - Add to outflows
      NOTE: Liabilities are handled within outflows since they're simply guaranteed payments that reduce principal and will force liquidation if needed, just like any other required outflow.
   
   b. Scheduled Outflows
      - Take base amount
      - If inflation-adjusted: × (1 + inflation)^(years_from_start)
      - Add to total outflows

   c. Retirement Spending (if retired)
      - Take base amount
      - If inflation-adjusted: × (1 + inflation)^(years_from_start)
      - Add to total outflows

5. NET CASH FLOW
   Total Inflows - Total Outflows = Net Cash Flow

6. HANDLE SURPLUS/DEFICIT
   If Surplus (Net Cash Flow > 0):
   - Add to investment accounts

   If Deficit (Net Cash Flow < 0): 
   - Liquidate assets in priority order until covered

7. END YEAR
   - Record final balances
   - These become next year's starting balances
   - Move to next year

Key Points:
- Growth rates apply FIRST, before any cash flows
- Inflation compounds from start year
- All year's inflows calculated before outflows
- Surplus/deficit handled last
- Everything happens in strict sequence
